GOTO 1.5

Статус:
Замечен баг при разлогине, надо чистить ls;
Замечен баг при аплоаде видео с расширением в верхнем регистре.

Нужен шеринг файлов.
1 Как сейчас организован getLink?
   hasAccessToFile можно доработать для проверки прав на общие файлы и пошареные.
   Тогда если добавить страницу проверки прав
   (входим, смотрим, если есть права, значит ок) то почти ок.
   
2 drivedwnlsmall - вызывается для файлов менее 40Мб.
  Есть ли проверка там?
  есть.
  
3 getFilePathObject 
  $symlink .= '/' . $fileEntity->getId() . $ext;
  менять на 
  $symlink .= '/' . $fileEntity->getHash() .'/' . transliteUrl($fileEntity->getName()) . $ext;
  
Тогда.
 например я вижу, что в ответ на гетлинк мне пришла ссылка с хешем.
 Начинаю перебирать хеши и слать их. 
 Если повезет, то качаю чужие файлы. Будем считать что подобрать хеш сложно.
 Если нужно конкретного пользователя, то это становится ещё сложнее.
 
На страницу проверки прав и getlink можно сколько угодно угодно бомбить рандомными id, сервер их не пропустит.
-----------
Реализация, пожалуй в отдельной ветке filehash.

Бэк. 
1 Делаем поле хеша для файла.											*
  Заполняем при аплоаде.
  Делаем поле is_public для файла.
  Его будем заполнять в п. 1 фронтенда.
  
2 getFilePathObject 													*
  $symlink .= '/' . $fileEntity->getId() . $ext;
  менять на 
  $symlink .= '/' . $fileEntity->getHash() .'/' . transliteUrl($fileEntity->getName()) . $ext;
  Учесть, что при удалении что-то с ней тоже делаем. Там теперь каталог надо удалять. 
  
  

3 Создать новую сущность. file_id K, user_id K, created_time			*
		*
3 Исправить функцию проверки доступа к файлу							*

100 Чекнуть, не станет ли возможным удалять чужой файл, если он общий.	*


Фронтенд.
1 Пункт "Ссылка на файл" в меню файла.									*
  Показывается экран 2.
  Верстка экрана 2 в процессе.											*
  Отключить показ экрана в u.js под // dev								*
  Есть идея добавить кнопки выхода напротив пунктов For					*
  НЕ нужно отработать вид процесса загрузки списка пользователей.
1.5
  Нужно добавиь выход при нажатии на Выход напротив вариантов шеринга.
  Прни этом надо сохранять настройку шеринга.
  
  Метод бэка есть.														*
  Делаем новый файл для установки url.									*
  Руками добавляем в таблицу юзеров для опытного файла и делаем 		*
	ренденрингсписка.
  Удаление из группы есть,
  
  
  

2 Экран с правами.
    - Только мне
    - Для всех
    - Пользователям:
    - Идут логины разрешенных пользователей.,
    - кнопка "Добавить"
При выборе не "Только мне" становится доступна кнопка копирования ссылки.
На a2 кнопка копирования ссылки работает, показывая поле ввода со ссылкой
    - локализация.
     

3 Экран добавления пользователя.
  Поле ввода. После ввода двух символов начинается поиск.
  Ниже список с найденными. Всегда не более трех.
  При выборе видим конфирм, правда ли этому дать доступ.
  После подтверждения возвращаемся на экран 2.

4 Экран на который переходим по ссылке. Видим сообщение 
		про проверку доступа. Сами отправляем getLink;
   Если прав нет, то так и пишем.
   Обязательно ссылка на промо-страницу.
   Хочется анимацию облаков днём и ночное небо с большой
		медведицей ночью.

5 Промо экран. 
	Пишем, что это ещё 1Гб для вас. 
	Но главное не это.
	Главное, что эти файлы доступны с любого утюга android2+, ie6+

Заметка. Версию для ie6 будем пилить на старом ПК.
Бэк можно будет сделать на основной машине (а зачем нам отдельный бэк?).
Фронтенд можно будет пилить и впрямь на старой машине. 
По FTP гонять, если не удастся php 7 в XP запустить.





Цель:
Онлайн хранилище а-ля гуглдрайв для старых смартфонов ( и новых и пк).
С редактором текстов.

1 Делаем рабочую копию (в каталоге fd (FormData)). Она просто работает так же как a2 *
2 Делаем аплоад с FormData.	*
3 Делаем учёт ssl (d 0.js запрашиваем по ssl пустой файл. Запоминаем удачно или нет.) *
4 Добавляем значок меню сверху.
 4.1 Кнопка.				*
 4.2 При нажатии на неё показываем главное меню. *
5 Выпиливаем backButton функционал.				 * (?)
6 Выпиливаем алерт backButton
 6.1 Выпиливаем диалог.							 *
7 Главное меню переносим вверх					 *
 7.1 Верстаем меню.								 *
 7.2 Выпиливаем нижнее меню, включая стили.      *
 
8 Экран авторизации. Как там с ssl?				 *
 - При первой смене языка не мешало бы редиректить на ssl - а в остальном норм.
 
9 Мультизагрузка.								*

 
10 Прикручиваем кэширование.					*
	(В самой приближенной версии done.) 
	В последствии надо научиться разрегистрировать 
	основной sw  и подключать новый
	 потому что мы хотиим кешировать mp3
	
10.1 Скачай из dev/addHs и подумай, надо ли оно тебе. (!)


11 Авторизация через соц. сети.
   1 Делаем просто страничку со сменой пользователей
   То есть мы берем просто двух админов и им показываем поле в userId 
	введя которое мы изменяем текущую сессию.
	
   - Есть. Далее, когда всё по авторизации через соц. сети будет готово, авторизацию сделать по сути как в changeUserAction.
    Только вместо recoveryHash там будет хеш из соц сети.
    
    Кнопку выхода делаем. * 
    
    В каталоге slg оставляем в 
     index.html только форму авторизации.
     Иконку - замок и открытый замок.
     флексим.
     (если что делай это всё из fd)
     
    По всей видимости будет slg/fb e. t. c.
     
    На эту страницу будет редирект с fb и прочего.
    1 Отправляем хеш.
    2 Бэк отправляет хеш в соц. сеть.
    3 Соц. сеть возвращает id в соц. сети (В socnet_user нужно ещё поле socnet_uid)
    4 По этому id находим userId.
      Если не найден, создаём новую запись в ausers
    5 Подменяем для пользователя хеш пароля на временный.
    6 Возвращаем данные на фронт (всё, что бывает в форме авторизации)
    7 Логинимся, затираем хеш временного пароля.

А у меня правда Sym 5.0.3??? - да

2 


В a2 версии пофиксить кнопку Cancel на форме загрузки.

----




d/drive/d  - access denied
По запросам парсим активный каталог.
При запросе файла копируем в t и создаем крон-задачу которая для файлов меньше 
500М через час дропает, для болших через 4 часа.


---
Дерево каталогов.
Пусть для userId = 25 
d/drive/d/1-100/25 - это корень его физической файловой системы.

Можно d/drive/d хранить отдельно в конфиге.
1-100/25 - величина вычисляемая (userId == 25 < 100).

Всё что лежит в d/drive/d/1-100/25 имеет parent_id = 0.

CREATE TABLE drv_catalogs (
`id` INTEGER PRIMARY KEY NOT NULL AUTO_INCREMENT COMMENT 'Таблица с деревом каталогов пользователя',
`user_id` INTEGER COMMENT 'ausers.id',
`parent_id` INTEGER DEFAULT 0 COMMENT 'drv_catalog.id',
`name` VARCHAR(255) COMMENT 'Имя каталога',
`is_deleted` TINYINT(1) DEFAULT 0 COMMENT 'Флаг удален или нет',
`is_hide` TINYINT(1) DEFAULT 0 COMMENT 'Флаг скрытый или нет',
INDEX `user_id` (`user_id`),
INDEX `parent_id` (`parent_id`),
INDEX `is_deleted` (`is_deleted`),
INDEX `is_hide` (`is_hide`)
)engine=innoDB DEFAULT CHARSET=utf8;
